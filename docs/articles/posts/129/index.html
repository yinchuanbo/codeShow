<!DOCTYPE html>






























<html
  class="not-ready text-sm lg:text-base"
  style="--bg: "
  lang="en"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>超有用的 Web API - 灏天阁</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="Screen Wake Lock API Screen Wake Lock API 提供了一种方式，使得当应用程序需要保持运行时，能够防止设备因为闲置而自动调低亮度或锁定屏幕。
这对于如视频会议、演示文稿、实时游戏、在线教育等需要用户持续关注且不允许屏幕熄灭的应用场景尤其有用。
通过这个 API，即使在没有用户交互的情况下，开发者也能确保屏幕始终保持开启状态。
&lt;button onclick=&#34;onLockScreen()&#34;&gt;锁屏&lt;/button&gt; &lt;button onclick=&#34;onUnlockScreen()&#34;&gt;释放&lt;/button&gt; &lt;div id=&#34;statusElem&#34;&gt;&lt;/div&gt; let wakeLock = null; async function onLockScreen() { try { wakeLock = await navigator.wakeLock.request(&#34;screen&#34;); statusElem.textContent = &#34;唤醒锁已激活&#34;; wakeLock.addEventListener(&#34;release&#34;, () =&gt; { statusElem.textContent = &#34;唤醒锁已释放&#34;; }); } catch (err) { statusElem.textContent = `${err.name}, ${err.message}`; } } async function onUnlockScreen() { if (!wakeLock) return; wakeLock.release().then(() =&gt; { wakeLock = null; }); } Cookie Store API 按照以往，开发者如何获取 cookie 信息呢？当前是 document." />
  <meta name="author" content="" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="/articles/main.min.css" />

  

  
  
  
    
  
  <link
    rel="preload"
    as="image"
    href="/articles/theme.png"
  />

  
  
  
  <link rel="preload" as="image" href="/imgs/logo.png" />
  
  

  

  
  <link rel="icon" href="/img/ico.ico" />
  <link rel="apple-touch-icon" href="/articles/apple-touch-icon.png" />
  
  <meta name="generator" content="Hugo 0.108.0">

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="超有用的 Web API" />
<meta property="og:description" content="Screen Wake Lock API Screen Wake Lock API 提供了一种方式，使得当应用程序需要保持运行时，能够防止设备因为闲置而自动调低亮度或锁定屏幕。
这对于如视频会议、演示文稿、实时游戏、在线教育等需要用户持续关注且不允许屏幕熄灭的应用场景尤其有用。
通过这个 API，即使在没有用户交互的情况下，开发者也能确保屏幕始终保持开启状态。
&lt;button onclick=&#34;onLockScreen()&#34;&gt;锁屏&lt;/button&gt; &lt;button onclick=&#34;onUnlockScreen()&#34;&gt;释放&lt;/button&gt; &lt;div id=&#34;statusElem&#34;&gt;&lt;/div&gt; let wakeLock = null; async function onLockScreen() { try { wakeLock = await navigator.wakeLock.request(&#34;screen&#34;); statusElem.textContent = &#34;唤醒锁已激活&#34;; wakeLock.addEventListener(&#34;release&#34;, () =&gt; { statusElem.textContent = &#34;唤醒锁已释放&#34;; }); } catch (err) { statusElem.textContent = `${err.name}, ${err.message}`; } } async function onUnlockScreen() { if (!wakeLock) return; wakeLock.release().then(() =&gt; { wakeLock = null; }); } Cookie Store API 按照以往，开发者如何获取 cookie 信息呢？当前是 document." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/articles/posts/129/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-17T16:57:01+08:00" />
<meta property="article:modified_time" content="2024-03-17T16:57:01+08:00" />

  
  <meta itemprop="name" content="超有用的 Web API">
<meta itemprop="description" content="Screen Wake Lock API Screen Wake Lock API 提供了一种方式，使得当应用程序需要保持运行时，能够防止设备因为闲置而自动调低亮度或锁定屏幕。
这对于如视频会议、演示文稿、实时游戏、在线教育等需要用户持续关注且不允许屏幕熄灭的应用场景尤其有用。
通过这个 API，即使在没有用户交互的情况下，开发者也能确保屏幕始终保持开启状态。
&lt;button onclick=&#34;onLockScreen()&#34;&gt;锁屏&lt;/button&gt; &lt;button onclick=&#34;onUnlockScreen()&#34;&gt;释放&lt;/button&gt; &lt;div id=&#34;statusElem&#34;&gt;&lt;/div&gt; let wakeLock = null; async function onLockScreen() { try { wakeLock = await navigator.wakeLock.request(&#34;screen&#34;); statusElem.textContent = &#34;唤醒锁已激活&#34;; wakeLock.addEventListener(&#34;release&#34;, () =&gt; { statusElem.textContent = &#34;唤醒锁已释放&#34;; }); } catch (err) { statusElem.textContent = `${err.name}, ${err.message}`; } } async function onUnlockScreen() { if (!wakeLock) return; wakeLock.release().then(() =&gt; { wakeLock = null; }); } Cookie Store API 按照以往，开发者如何获取 cookie 信息呢？当前是 document."><meta itemprop="datePublished" content="2024-03-17T16:57:01+08:00" />
<meta itemprop="dateModified" content="2024-03-17T16:57:01+08:00" />
<meta itemprop="wordCount" content="1135">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="超有用的 Web API"/>
<meta name="twitter:description" content="Screen Wake Lock API Screen Wake Lock API 提供了一种方式，使得当应用程序需要保持运行时，能够防止设备因为闲置而自动调低亮度或锁定屏幕。
这对于如视频会议、演示文稿、实时游戏、在线教育等需要用户持续关注且不允许屏幕熄灭的应用场景尤其有用。
通过这个 API，即使在没有用户交互的情况下，开发者也能确保屏幕始终保持开启状态。
&lt;button onclick=&#34;onLockScreen()&#34;&gt;锁屏&lt;/button&gt; &lt;button onclick=&#34;onUnlockScreen()&#34;&gt;释放&lt;/button&gt; &lt;div id=&#34;statusElem&#34;&gt;&lt;/div&gt; let wakeLock = null; async function onLockScreen() { try { wakeLock = await navigator.wakeLock.request(&#34;screen&#34;); statusElem.textContent = &#34;唤醒锁已激活&#34;; wakeLock.addEventListener(&#34;release&#34;, () =&gt; { statusElem.textContent = &#34;唤醒锁已释放&#34;; }); } catch (err) { statusElem.textContent = `${err.name}, ${err.message}`; } } async function onUnlockScreen() { if (!wakeLock) return; wakeLock.release().then(() =&gt; { wakeLock = null; }); } Cookie Store API 按照以往，开发者如何获取 cookie 信息呢？当前是 document."/>

  
  
</head>
  <body class="text-black duration-200 ease-out dark:text-white">
    
    

    
    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 dark:prose-invert"
      id="main"
    >
      

<article>
  <header class="mb-10">
    <h1 class="!my-0 pb-2.5">
      超有用的 Web API
    </h1>

    
    <div class="text-sm opacity-60">
      
      <time>Mar 17, 2024</time>
      
      
      <span class="mx-1">&middot;</span>
      <span>Yin灏</span>
    </div>
    
  </header>

  <section><h2 id="screen-wake-lock-api">Screen Wake Lock API</h2>
<p>Screen Wake Lock API 提供了一种方式，使得当应用程序需要保持运行时，能够防止设备因为闲置而自动调低亮度或锁定屏幕。</p>
<p>这对于如视频会议、演示文稿、实时游戏、在线教育等需要用户持续关注且不允许屏幕熄灭的应用场景尤其有用。</p>
<p>通过这个 API，即使在没有用户交互的情况下，开发者也能确保屏幕始终保持开启状态。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onclick</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;onLockScreen()&#34;</span>&gt;锁屏&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onclick</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;onUnlockScreen()&#34;</span>&gt;释放&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;statusElem&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">wakeLock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onLockScreen</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wakeLock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">wakeLock</span>.<span style="color:#a6e22e">request</span>(<span style="color:#e6db74">&#34;screen&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">statusElem</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;唤醒锁已激活&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wakeLock</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;release&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">statusElem</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;唤醒锁已释放&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">statusElem</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onUnlockScreen</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">wakeLock</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wakeLock</span>.<span style="color:#a6e22e">release</span>().<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wakeLock</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="cookie-store-api">Cookie Store API</h2>
<p>按照以往，开发者如何获取 cookie 信息呢？当前是 <code>document.cookie</code>。</p>
<p>这种的缺点是没法知道 <code>domain</code>、<code>path</code>、<code>expired</code> 等信息。</p>
<p>Cookie Store API 可以获取开发工具的 cookie 属性，当然，具有 <code>HttpOnly</code> 的属性的是获取不到的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">cookieStore</span>.<span style="color:#a6e22e">getAll</span>();
</span></span></code></pre></div><img src="../../img/129/01.png" />
<p><strong>当然还提供了</strong></p>
<ul>
<li>
<p>cookieStore.delete: 删除</p>
</li>
<li>
<p>cookieStore.get: 获取单个 cookie 信息</p>
</li>
<li>
<p>cookieStore.set: 设置单个 cookie 信息</p>
</li>
</ul>
<h2 id="compression-stream-api">Compression Stream API</h2>
<p>Compression Stream API 提供一种 Js API，使用 gzip 或者默认格式压缩和解压缩数据流，内置的压缩库意味着 Js 应用不再需要包含其他压缩库，这使得应用程序的下载大小更小。</p>
<p>比如下面上传一个文本文件到浏览器，代码采用 gzip 压缩纯文本之后，从 6kb 变为了 1kb，解压缩后又变成了 6kb。</p>
<img src="../../img/129/02.png" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">compressAndDownload</span>(<span style="color:#a6e22e">filename</span>, <span style="color:#a6e22e">content</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 创建原始数据流
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stringStream</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ReadableStream</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">start</span>(<span style="color:#a6e22e">controller</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">enqueue</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TextEncoder</span>().<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">content</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">controller</span>.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 创建压缩流
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">compressionStream</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CompressionStream</span>(<span style="color:#e6db74">&#34;gzip&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 将原始数据流连接到压缩流
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">compressedStream</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stringStream</span>.<span style="color:#a6e22e">pipeThrough</span>(<span style="color:#a6e22e">compressionStream</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 创建ArrayBuffer容器接收压缩数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chunks</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">compressedStream</span>.<span style="color:#a6e22e">getReader</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">done</span>, <span style="color:#a6e22e">value</span> } <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">done</span>) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">chunks</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">value</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">releaseLock</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 合并压缩数据并创建Blob
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">compressedBlob</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Blob</span>(<span style="color:#a6e22e">chunks</span>, { <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/gzip&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 创建下载链接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">compressedBlob</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">link</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;a&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">download</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">filename</span><span style="color:#e6db74">}</span><span style="color:#e6db74">.gz`</span>;
</span></span><span style="display:flex;"><span>    document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">link</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 触发下载
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">click</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 清理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">removeChild</span>(<span style="color:#a6e22e">link</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>    }, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;change&#34;</span>, <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FileReader</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">readAsText</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">result</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">compressAndDownload</span>(<span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">content</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><h2 id="css-custom-highlight-api">CSS Custom Highlight API</h2>
<p>CSS 自定义高亮 API 提供了一种方法，可以通过使用 Js 创建范文并使用 CSS 定义样式来设置文档中任意文本范围的样式。</p>
<img src="../../img/129/03.png" />
<p>其逻辑就是查找所有文本节点，收集匹配内容的 <code>Range</code>，最后作为参数构建 <code>HighLight</code> 对象，需要注意的是其 <code>并未产生新的节点</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;query&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">article</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;article&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Find all text nodes in the article. We&#39;ll search within these text nodes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">treeWalker</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createTreeWalker</span>(<span style="color:#a6e22e">article</span>, <span style="color:#a6e22e">NodeFilter</span>.<span style="color:#a6e22e">SHOW_TEXT</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">allTextNodes</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentNode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">treeWalker</span>.<span style="color:#a6e22e">nextNode</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">currentNode</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">allTextNodes</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">currentNode</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">currentNode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">treeWalker</span>.<span style="color:#a6e22e">nextNode</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Listen to the input event to run the search.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;input&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// If the CSS Custom Highlight API is not supported, display a message and bail-out.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">CSS</span>.<span style="color:#a6e22e">highlights</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">article</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CSS Custom Highlight API not supported.&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Clear the HighlightRegistry to remove the previous search results.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">CSS</span>.<span style="color:#a6e22e">highlights</span>.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Clean-up the search query and bail-out if if it&#39;s empty.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">trim</span>().<span style="color:#a6e22e">toLowerCase</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">str</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Iterate over all text nodes and find matches.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ranges</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">allTextNodes</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">el</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">textContent</span>.<span style="color:#a6e22e">toLowerCase</span>() };
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>(({ <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">el</span> }) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">indices</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">startPos</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">startPos</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">startPos</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">indices</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">index</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">startPos</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Create a range object for each instance of str we found in the text node.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">indices</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">index</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">range</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Range</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setStart</span>(<span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">index</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setEnd</span>(<span style="color:#a6e22e">el</span>, <span style="color:#a6e22e">index</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">range</span>;
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Create a Highlight object for the ranges.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">searchResultsHighlight</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Highlight</span>(...<span style="color:#a6e22e">ranges</span>.<span style="color:#a6e22e">flat</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Register the Highlight object in the registry.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">CSS</span>.<span style="color:#a6e22e">highlights</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#34;search-results&#34;</span>, <span style="color:#a6e22e">searchResultsHighlight</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="eyedropper">EyeDropper</h2>
<p>可以打开并使用它从屏幕上选择颜色。</p>
<img src="../../img/129/04.png" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;start-button&#34;</span>&gt;打开拾色器&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://img.alicdn.com/imgextra/i1/O1CN01CC9kic1ig1r4sAY5d_!!6000000004441-2-tps-880-210.png&#34;</span>
</span></span><span style="display:flex;"><span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span>&gt;颜色是：&lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;result&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;start-button&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">resultElement</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;result&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>window.<span style="color:#a6e22e">EyeDropper</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">resultElement</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;你的浏览器不支持 EyeDropper API&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eyeDropper</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EyeDropper</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">abortController</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AbortController</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">eyeDropper</span>
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">open</span>({ <span style="color:#a6e22e">signal</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">abortController</span>.<span style="color:#a6e22e">signal</span> })
</span></span><span style="display:flex;"><span>      .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">result</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">resultElement</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">sRGBHex</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">resultElement</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">backgroundColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">sRGBHex</span>;
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>      .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">e</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">resultElement</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>;
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><h2 id="prioritized-task-scheduling-api">Prioritized Task Scheduling API</h2>
<p>提供了一种标准化的方法，用于对属于应用程序的所有任务进行优先级排序。</p>
<p>优先级任务调度 API 允许开发者为异步任务分配优先级，这些任务按照以下三种优先级顺序执行：</p>
<ol>
<li>
<p>user-blocking：这类任务优先级最高，它们直接影响用户的交互体验。这类任务主要包括页面渲染至可交互状态的过程，以及对用户输入的即时响应。例如，页面初次加载的核心内容渲染、按钮点击事件的处理等。</p>
</li>
<li>
<p>user-visible： 这类任务虽可见于用户界面，但并不阻止用户继续进行其他操作。这类任务包括渲染页面的非关键部分，例如非核心图片加载、非关键动画渲染等。这是默认的优先级等级。</p>
</li>
<li>
<p>background： 优先级最低的一类任务，它们对时间要求不严苛，可以在不影响用户体验的前提下稍后执行。这类任务包括日志处理、非必需的第三方库初始化以及其他不影响页面即时呈现的工作。这些任务通常在主线程空闲时执行，以避免阻塞用户可见或交互相关的高优先级任务。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;log&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">log</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;log&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mylog</span>(<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">text</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;br/&gt;`</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// three tasks, in reverse order of priority
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;background 1&#34;</span>), { <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;background&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;user-visible 1&#34;</span>), {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user-visible&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;user-blocking 1&#34;</span>), {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user-blocking&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// three more tasks, in reverse order of priority
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;background 2&#34;</span>), { <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;background&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;user-visible 2&#34;</span>), {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user-visible&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;user-blocking 2&#34;</span>), {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user-blocking&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Task with default priority: user-visible
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">scheduler</span>.<span style="color:#a6e22e">postTask</span>(() =&gt; <span style="color:#a6e22e">mylog</span>(<span style="color:#e6db74">&#34;user-visible 3 (default)&#34;</span>));
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><img src="../../img/129/05.png" />
<h2 id="trusted-types-api">Trusted Types API</h2>
<p>为 Web 开发者提供了一种锁定 DOM API 中不安全部分的方法，目的是防止客户端跨站脚本（<code>Cross-site scripting，XSS</code>）攻击</p>
<p>在下面的例子中，通过 <code>TrustedTypePolicyFactory.createPolicy()</code> 方法创建一个策略，通过 <code>TrustedTypePolicy.createHTML</code> 方法创建一个安全的 HTML 字符串插入到文档中。</p>
<p>有很大的灵活性，策略是自己可以定义的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;myDiv&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">entityMap</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&amp;&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;amp;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&lt;&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;lt;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&gt;&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#34;&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;quot;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;#39;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&amp;#x2F;&#34;</span>,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 创建一个策略，该策略将用于将不受信任的输入转换为安全的内容。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">escapeHTMLPolicy</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">trustedTypes</span>.<span style="color:#a6e22e">createPolicy</span>(<span style="color:#e6db74">&#34;myEscapePolicy&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">createHTML</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">string</span>) =&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[&amp;&lt;&gt;&#34;&#39;\/]/g</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">s</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">entityMap</span>[<span style="color:#a6e22e">s</span>];
</span></span><span style="display:flex;"><span>      }),
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;myDiv&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">escaped</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">escapeHTMLPolicy</span>.<span style="color:#a6e22e">createHTML</span>(<span style="color:#e6db74">&#34;&lt;img src=x onerror=alert(1)&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">escaped</span> <span style="color:#66d9ef">instanceof</span> <span style="color:#a6e22e">TrustedHTML</span>); <span style="color:#75715e">// true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">escaped</span>;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>除此之外，还可以用来创建用来检查 <code>Script</code> 和 <code>ScriptURL</code> 的策略。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">policy</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">trustedTypes</span>.<span style="color:#a6e22e">createPolicy</span>(<span style="color:#e6db74">&#34;myPolicy&#34;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createScriptURL</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">sink</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createScript</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">s</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="css-font-loading-api">CSS Font Loading API</h2>
<p>CSS 字体加载 API 为你提供了动态加载字体资源的事件和接口。</p>
<p>以往引入字体主要是靠 css 来实现的, 动态引入字体也可以通过动态添加 link 节点来实现。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>@<span style="color:#66d9ef">font-face</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">font-family</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;MyCustomFont&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">src</span><span style="color:#f92672">:</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fonts/mycustomfont.woff2&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff2&#34;</span><span style="color:#f92672">),</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;fonts/mycustomfont.woff&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;woff&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">font-weight</span><span style="color:#f92672">:</span> <span style="color:#f92672">normal</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">font-style</span><span style="color:#f92672">:</span> <span style="color:#f92672">normal</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>现在内置了原生 API， 能动态加载字体，而且能控制加载时机，以及加载的状态。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">font</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FontFace</span>(<span style="color:#e6db74">&#34;myfont&#34;</span>, <span style="color:#e6db74">&#34;url(myfont.woff)&#34;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;italic&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">weight</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;400&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">stretch</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;condensed&#34;</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 加载字体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">font</span>.<span style="color:#a6e22e">load</span>().<span style="color:#a6e22e">then</span>(
</span></span><span style="display:flex;"><span>  () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 加载完毕
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 加载异常
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 等待到所有的字体都加载完毕
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>document.<span style="color:#a6e22e">fonts</span>.<span style="color:#a6e22e">ready</span>.<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 使用该字体渲染文字（如：在 canvas 中绘制）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span></code></pre></div><h2 id="url-pattern-api">URL Pattern API</h2>
<p>URL Pattern API 定义了一种语法，该语法用于创建 URL 模式匹配器。这些模式能够与完整的 URL 或 URL 的各个组成部分进行匹配。 其借鉴了 <a href="https://github.com/pillarjs/path-to-regexp">path-to-regexp</a>的语法。</p>
<p>匹配模块包含： URL Pattern API 的模式语法包括：</p>
<ol>
<li>
<p><strong>字面字符串</strong>：将精确匹配的文本字符串，例如 &ldquo;/home&rdquo; 或 &ldquo;/contact&rdquo;。</p>
</li>
<li>
<p><strong>通配符</strong>：如 &ldquo;/posts/ <em>&rdquo; 中的星号 (</em> ) 表示匹配任何字符序列，直至遇到下一个路径分隔符（/）。</p>
</li>
<li>
<p><strong>命名组</strong>：如 &ldquo;/books/:id&rdquo; 中的 &ldquo;:id&rdquo;，它会提取匹配 URL 中对应部分的值，作为单独的数据项。</p>
</li>
<li>
<p><strong>非捕获组</strong>：如 &ldquo;/books{/old}?&quot;，这里的花括号  <code>{...}?</code>  表示该部分模式是可选的，可以匹配 0 次或 1 次，且不会作为一个单独的数据项提取出来。</p>
</li>
<li>
<p><strong>正则表达式组</strong>：如 &ldquo;/books/(\d+)&rdquo; 中的  <code>(\d+)</code>，这部分遵循 JavaScript 正则表达式的规则，用于进行复杂匹配，尽管在 URL Pattern API 中有一定的限制。例如，此处的正则表达式将匹配一个或多个数字字符，并将其作为一个独立的数据项提取出来。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// A pattern matching with a named group
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pattern</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URLPattern</span>({ <span style="color:#a6e22e">pathname</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/books/:id&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">pattern</span>.<span style="color:#a6e22e">test</span>(<span style="color:#e6db74">&#34;https://example.com/books/123&#34;</span>)); <span style="color:#75715e">// true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">pattern</span>.<span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;https://example.com/books/123&#34;</span>).<span style="color:#a6e22e">pathname</span>.<span style="color:#a6e22e">groups</span>); <span style="color:#75715e">// { id: &#39;123&#39; }
</span></span></span></code></pre></div><h2 id="audio-output-devices-api">Audio Output Devices API</h2>
<p>音频输出设备 API（Audio Output Devices API）赋予了 Web 应用程序能力，使其能够询问用户希望使用哪个音频输出设备进行声音播放。</p>
<p>欸， 可以选择音频输出设备，还是比较有意思的。协议原文 <a href="https://w3c.github.io/mediacapture-output/">Audio Output Devices API</a>， 可惜还没有浏览器支持。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;#myButton&#34;</span>).<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>, <span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">mediaDevices</span>.<span style="color:#a6e22e">selectAudioOutput</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;selectAudioOutput() not supported or not in secure context.&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Display prompt to select device
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">audioDevice</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">mediaDevices</span>.<span style="color:#a6e22e">selectAudioOutput</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Create an audio element and start playing audio on the default device
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">audio</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;audio&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">audio</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://example.com/audio.mp3&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">audio</span>.<span style="color:#a6e22e">play</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Change the sink to the selected audio output device.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">audio</span>.<span style="color:#a6e22e">setSinkId</span>(<span style="color:#a6e22e">audioDevice</span>.<span style="color:#a6e22e">deviceId</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="device-memory-api">Device Memory API</h2>
<p>传统上，开发人员评估客户端设备性能时，由于无法直接获取设备的 RAM 大小信息，他们往往需要采取一些经验法则，或是通过设备基准测试，抑或是根据设备制造商、用户代理(User Agent)字符串等其他因素间接推测设备能力。</p>
<p>但现在，有以下两种方法可以直接或间接确定设备的大致 RAM 量：</p>
<ol>
<li>
<p><strong>Device Memory JavaScript API</strong>： 这个 API 为开发者提供了一种直接了解设备内存（RAM）容量的方式。通过<code>navigator.deviceMemory</code>属性，可以获得设备内存级别的大致信息，如 0.5 表示小于 1GB 的 RAM，1 表示 1-2GB，以此类推。</p>
</li>
<li>
<p><strong>接受 Client Hints</strong>： 客户端提示（Client Hints）是一种 HTTP 协议扩展，允许浏览器在 HTTP 请求中主动发送设备能力相关信息。其中，<code>Device-Memory</code> HTTP 请求头就包含了设备的内存类别信息。虽然这不是直接在 JavaScript 中获取，但服务器可以根据这个头信息动态调整响应内容，帮助开发者根据设备 RAM 大小优化用户体验。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">RAM</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">navigator</span>.<span style="color:#a6e22e">deviceMemory</span>; <span style="color:#75715e">// 8
</span></span></span></code></pre></div><p>值是  <code>0.25</code>, <code>0.5</code>, <code>1</code>, <code>2</code>, <code>4</code>，<code>8</code> 之一，所以机器 16G 内存，显示的也是 8。</p>
<h2 id="barcode-detection-api">Barcode Detection API</h2>
<p>用于检测图像中的条形码和二维码。</p>
<p>欸， 这就很有意思，配和 <code>navigator.mediaDevices.getUserMedia</code>唤起摄像头，定期截图分析，是不是就是一个 web 版本的扫码能力呢？</p>
<img src="../../img/129/01.awebp" />
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;BarcodeDetector&#34;</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">globalThis</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;此浏览器不支持条形码检测器。&#34;</span>);
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;条形码检测器是支持的！&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 创建新检测器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">barcodeDetector</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BarcodeDetector</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">formats</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;code_39&#34;</span>, <span style="color:#e6db74">&#34;codabar&#34;</span>, <span style="color:#e6db74">&#34;ean_13&#34;</span>],
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">barcodeDetector</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">detect</span>(<span style="color:#a6e22e">imageEl</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">barcodes</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">barcodes</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">barcode</span>) =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">barcode</span>.<span style="color:#a6e22e">rawValue</span>));
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="css-typed-object-model-api">CSS Typed Object Model API</h2>
<p>CSS Typed Object Model（CSSOM）API 从根本上改变了开发者在 JavaScript 中处理 CSS 属性的方式，通过引入类型安全性和效率优化。</p>
<p>比如：简简单单就能获取样式的键值对， 其实还有一个结果有类似功能 API <code>window.getComputedStyle</code></p>
<img src="../../img/129/02.awebp" /></section>

  
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a class="flex w-1/2 items-center p-6 pr-3 no-underline" href="/articles/posts/130/"
      ><span class="mr-1.5">←</span><span>动态执行 js 的方法</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline"
      href="/articles/posts/128/"
      ><span>JS复制粘贴兼容处理</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
  style="position: relative; z-index: 10;display: none;"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="/articles/">灏天阁</a>
  </div>
  <a class="link" href="https://yinchuanbo.github.io/" rel="noopener" target="_blank"
    >Powered by YinHao</a
  >️ ▷
</footer>


    <div class="img__mask" style="display: none;">
      <img src="" alt="">
      <span class="close_btn"></span>
    </div>

    <script>
      const imgs = document.images;
      const imgMask = document.querySelector('.img__mask')
      const closeBtn = document.querySelector('.close_btn')
      for (let i = 0; i < imgs.length; i++) {
        const element = imgs[i];
        element.onclick = () => {
          const src = element.src;
          imgMask.style.display = 'flex';
          imgMask.querySelector('img').src = src;
        }
      }
      closeBtn.onclick = () => {
        imgMask.style.display = 'none';
      }
    </script>
  </body>
</html>
